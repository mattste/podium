{% extends "base.html" %}


{% block content %}
  <form id="pollForm" role="form">
    <label>Question
    <input type="text" name="question" id="question">
    </label>
    <div class="wrapper">
      <div class="multi-fields">
        <div class="multi-field">
          <input type="radio" name="choices">  <input type="text" name="options">
          <button type="button" class="delete-field">Delete</button>
        </div>
      </div>
    <button type="button" class="add-field">Add field</button>
  </div>
    <p><input type="submit" value="Save" /></p>
  </form>

  <pre id="output"> </pre>
{% endblock %}

{% block shouts %}
{% include "shouts.html" %}
{% endblock %}

{% block scripts %}
  {{ super() }}
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
  <script type="text/javascript"> 
  $(document).ready(function() {
    $('.wrapper').each(function () {
        
        // Save context
        var $wrapper = $('.multi-fields', this);
        
        // Add
        $(".add-field", $(this)).click(function (e) {
            $('.multi-field:first-child', $wrapper).clone(true).appendTo($wrapper).find('input').val('').focus();
        });
        
        // Delete
        $('.multi-field .delete-field', $wrapper).click(function () {
            if ($('.multi-field', $wrapper).length > 1) $(this).parent('.multi-field').remove();
        });
    });

  });



  $.fn.serializeObject = function()
  {
      var o = {};
      var a = this.serializeArray();
      $.each(a, function() {
          if (o[this.name] !== undefined) {
              if (!o[this.name].push) {
                  o[this.name] = [o[this.name]];
              }
              o[this.name].push(this.value || '');
          } else {
              o[this.name] = this.value || '';
          }
      });
      return o;
  };

  $(function() {
      $('form').submit(function(e) {
          e.preventDefault();
          var poll_info = $('form').serializeObject();
          poll_info["podium_title"] = "{{ podium_title }}";
          poll_info["question"] = $('#pollForm #question').val();
          $.ajax({
            type: "POST",
            url: "/podium/poll/create",
            data: JSON.stringify(poll_info),
            success: function (data) {
              $("#output").html(data["message"]);
            },
            dataType: "json",
            contentType: "application/json"
          });
          return false;
      });
  });

</script>
{% endblock %}